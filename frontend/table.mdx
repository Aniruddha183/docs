---
title: "Dynamic Table Component"
description: "Integrate and customize a dynamic and paginated table in your Next.js project"
---

### Dynamic Table Component

<Frame>
  <img src="/images/dynamic-table.png" style={{ borderRadius: "0.5rem" }} />
</Frame>

#### Overview

The `DynamicTable` component is a versatile and customizable table that supports pagination, search, sorting, row selection, expandable rows, and conditional styling. It is designed to handle large datasets efficiently with a dynamic data-fetching mechanism.

#### Features

- **Searchable Columns**: Each column includes a search field for filtering data.
- **Sortable Columns**: Click column headers to toggle ascending/descending sort.
- **Pagination**: Enhanced pagination with ellipses for large datasets and better navigation.
- **Row Selection**: Supports selecting and deselecting rows for further actions, including a "select all" feature.
- **Expandable Rows**: Use `expandableKey` to show child entries under each row.
- **Preselect Rows**: Initialize selected rows using `preselectedItems` from `useData`.
- **Details Column**: Optional column for additional actions like editing or viewing details.
- **Customizable Keys**: Each row can be uniquely identified using the `uniqueKey` prop.
- **Custom Cell Styles**: Apply conditional styles to specific columns based on values.
- **Time Range Formatting**: Converts date-time and duration values into readable time ranges.
- **Selection Callback**: Notifies parent components when rows are selected.

#### Usage

**Code Snippet:**

```tsx
import DynamicTable from "./DynamicSessionTable";

const ExampleComponent = () => {
  const columns = [
    { key: "name", header: "Name" },
    { key: "email", header: "Email" },
    { key: "role", header: "Role" },
  ];

  const useData = (page, search) => {
    return {
      data: [
        {
          id: "1",
          name: "John Doe",
          email: "john@example.com",
          role: "Admin",
          children: [],
        },
        {
          id: "2",
          name: "Jane Doe",
          email: "jane@example.com",
          role: "User",
          children: [],
        },
      ],
      totalPages: 2,
      preselectedItems: ["1"],
    };
  };

  const handleDetailsClick = (item) => {
    console.log("Details clicked for", item);
  };

  return (
    <DynamicTable
      columns={columns}
      headerColor="#1E293B"
      useData={useData}
      showBorder
      showDetailsColumn
      uniqueKey="id"
      onDetailsClick={handleDetailsClick}
      onSelectionChange={(selectedIds) =>
        console.log("Selected IDs:", selectedIds)
      }
      expandableKey="children"
    />
  );
};
```

#### Props

| Prop                | Type                                                                                                 | Default     | Description                                                               |
| ------------------- | ---------------------------------------------------------------------------------------------------- | ----------- | ------------------------------------------------------------------------- |
| `columns`           | `Array<{ key: string; header: string }>`                                                             | `[]`        | Defines the structure and headers of the table.                           |
| `headerColor`       | `string`                                                                                             | `"#000"`    | Background color for the table header.                                    |
| `useData`           | `(page: number, search: string) => { data: any[]; totalPages: number; preselectedItems?: string[] }` | `undefined` | Function to fetch table data dynamically.                                 |
| `showBorder`        | `boolean`                                                                                            | `true`      | Whether to display a border around the table.                             |
| `showDetailsColumn` | `boolean`                                                                                            | `true`      | Whether to include a "Details" column for additional actions.             |
| `onDetailsClick`    | `(item: any) => void`                                                                                | `undefined` | Callback for when the details button is clicked.                          |
| `uniqueKey`         | `string`                                                                                             | `undefined` | The key used to uniquely identify rows.                                   |
| `customStyles`      | `Array<{ columnKey: string; condition: (value: string) => boolean; styles: object }>`                | `[]`        | Styles applied conditionally to specific columns.                         |
| `showTimeRange`     | `boolean`                                                                                            | `true`      | Displays formatted time range if applicable.                              |
| `onSelectionChange` | `(selectedIds: string[]) => void`                                                                    | `undefined` | Callback when row selections change.                                      |
| `sortColumn`        | `string`                                                                                             | `uniqueKey` | Column key to sort by initially.                                          |
| `sortOrder`         | `'asc' \| 'desc'`                                                                                    | `'desc'`    | Sorting order.                                                            |
| `preselectedItems`  | `string[]`                                                                                           | `[]`        | Optional initial list of selected row IDs.                                |
| `expandableKey`     | `string`                                                                                             | `undefined` | Optional key for accessing nested/child rows for expandable row handling. |

#### Anatomy

1. **Table Header**:

   - Displays column names and search inputs.
   - Includes sorting icons and a "select all" checkbox.

2. **Table Body**:

   - Renders rows based on fetched and sorted data.
   - Supports expandable child rows if `expandableKey` is defined.
   - Includes row checkboxes and optional custom cell rendering.

3. **Pagination**:
   - Navigation buttons with ellipses for long page lists.
   - Starts on the last page by default for reverse-ordered data.

#### Component Code

```tsx
"use client";

import { useState, useEffect } from "react";
import { useSearchParams, useRouter, usePathname } from "next/navigation";
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Checkbox } from "@/components/ui/checkbox";
import {
  ChevronLeft,
  ChevronRight,
  Edit,
  Search,
  ChevronUp,
  ChevronDown,
} from "lucide-react";

interface Column {
  key: string;
  header: string;
}

interface DynamicTableProps {
  columns: Column[];
  headerColor: string;
  useData: (
    page: number,
    search: string
  ) => {
    data: any[];
    totalPages: number;
    preselectedItems?: string[]; // Make this optional
  };
  showBorder?: boolean;
  showDetailsColumn?: boolean;
  onDetailsClick?: (item: any) => void;
  uniqueKey: string;
  customStyles?: {
    columnKey: string;
    condition: (value: string) => boolean;
    styles: {
      color?: string;
      border?: string;
      padding?: string;
      backgroundColor?: string;
    };
  }[];
  showTimeRange?: boolean;
  expandableKey?: string;
  onSelectionChange?: (selectedIds: string[]) => void; // ✅ New prop
}
function getFormattedTimeRange(dateTime: string, duration: number): string {
  const [date, time, period] = dateTime.split(" ");
  const [hours, minutes] = time.split(":").map(Number);
  const [expandedRows, setExpandedRows] = useState<Record<string, boolean>>({}); // State to track expanded rows

  // Convert to 24-hour format for calculation
  const startHours = period === "PM" && hours < 12 ? hours + 12 : hours;
  const startDate = new Date();
  startDate.setHours(startHours, minutes);

  // Calculate end time by adding the duration (in minutes)
  const endDate = new Date(startDate.getTime() + duration * 60000);

  // Format the end time back to 12-hour format
  const endHours = endDate.getHours();
  const endMinutes = endDate.getMinutes();
  const endPeriod = endHours >= 12 ? "PM" : "AM";
  const formattedEndHours = endHours % 12 || 12;

  return `${time} ${period} - ${formattedEndHours}:${endMinutes
    .toString()
    .padStart(2, "0")} ${endPeriod}`;
}

export default function DynamicTable({
  columns,
  headerColor,
  useData,
  showBorder = true,
  showDetailsColumn = true,
  onDetailsClick,
  uniqueKey,
  customStyles = [],
  expandableKey,
  showTimeRange = true,
  onSelectionChange, // ✅ New prop
}: DynamicTableProps) {
  const searchParams = useSearchParams();
  const pathname = usePathname();
  const { replace } = useRouter();
  const [page, setPage] = useState(1); // Initially set to 1, updated dynamically
  const [expandedRows, setExpandedRows] = useState<Record<string, boolean>>({});
  const [searchQueries, setSearchQueries] = useState<Record<string, string>>(
    Object.fromEntries(columns.map((col) => [col.key, ""]))
  );

  const searchQuery = Object.entries(searchQueries)
    .filter(([_, value]) => value.trim() !== "")
    .map(([key, value]) => `${key}:${value}`)
    .join(" ");

  const {
    data,
    totalPages,
    preselectedItems = [],
  } = useData(page, searchQuery);
  const handleSearchChange = (field: string, value: string) => {
    setSearchQueries({ ...searchQueries, [field]: value });
  };

  const [selectedRows, setSelectedRows] = useState<Set<string>>(new Set());

  const handleSelectAll = (checked: boolean) => {
    const newSelectedRows = checked
      ? new Set(data.map((item) => item[uniqueKey]))
      : new Set();
    setSelectedRows(newSelectedRows);
    onSelectionChange?.(Array.from(newSelectedRows)); // ✅ Notify parent
  };

  const toggleRowSelection = (id: string) => {
    const updatedSelectedRows = new Set(selectedRows);
    if (updatedSelectedRows.has(id)) {
      updatedSelectedRows.delete(id);
    } else {
      updatedSelectedRows.add(id);
    }
    setSelectedRows(updatedSelectedRows);
    onSelectionChange?.(Array.from(updatedSelectedRows)); // ✅ Notify parent
  };

  // Handle Page Change (Reversed)
  const handlePageChange = (newPage: number) => {
    if (newPage >= 1 && newPage <= totalPages) {
      setPage(newPage);
    }
  };

  // Pagination Buttons
  const getPaginationButtons = () => {
    const buttons = [];
    const maxVisible = 3;

    const addEllipsis = (key: string) => (
      <Button
        key={key}
        disabled
        className="rounded-none bg-transparent border border-[#525252] text-neutral-400 cursor-default"
      >
        ...
      </Button>
    );

    const addPageButton = (pageNum: number) => (
      <Button
        key={pageNum}
        variant={page === pageNum ? "default" : "outline"}
        onClick={() => handlePageChange(pageNum)}
        className="rounded-none border-[#525252]"
      >
        {pageNum}
      </Button>
    );

    if (totalPages <= 5) {
      for (let i = 1; i <= totalPages; i++) {
        buttons.push(addPageButton(i));
      }
    } else {
      if (page <= 3) {
        // First three pages
        buttons.push(addPageButton(1));
        buttons.push(addPageButton(2));
        buttons.push(addPageButton(3));
        buttons.push(addEllipsis("ellipsis-end"));
        buttons.push(addPageButton(totalPages));
      } else if (page >= totalPages - 2) {
        // Last three pages
        buttons.push(addPageButton(1));
        buttons.push(addEllipsis("ellipsis-start"));
        buttons.push(addPageButton(totalPages - 2));
        buttons.push(addPageButton(totalPages - 1));
        buttons.push(addPageButton(totalPages));
      } else {
        // Middle pages (fixing ellipsis position)
        buttons.push(addPageButton(page - 1));
        buttons.push(addPageButton(page));
        buttons.push(addPageButton(page + 1));
        buttons.push(addEllipsis("ellipsis-end"));
        buttons.push(addPageButton(totalPages));
      }
    }

    return buttons;
  };

  // Handling Prev & Next Arrows in Reverse Order
  // Pagination Arrow Functions
  const handlePrevPage = () => {
    if (page > 1) {
      handlePageChange(page - 1);
    }
  };

  const handleNextPage = () => {
    if (page < totalPages) {
      handlePageChange(page + 1);
    }
  };

  const customCellRender = (value: string, columnKey: string) => {
    if (columnKey === "dateTime") {
      // Check if the value contains the expected format with "|"
      if (!value.includes("|")) {
        return <div>Invalid Date/Time</div>;
      }

      const [date, timeRange] = value.split(" | "); // Split by " | "

      if (!timeRange) {
        return (
          <div>
            <div>{date}</div>
            <div>No Time Available</div>
          </div>
        );
      }

      return (
        <div>
          <div>{date}</div>
          <div>{timeRange}</div>
        </div>
      );
    }

    // Handle custom styles for other columns
    const matchingStyles = customStyles
      .filter(
        (style) => style.columnKey === columnKey && style.condition(value)
      )
      .map((style) => style.styles);

    const mergedStyles = matchingStyles.reduce(
      (acc, current) => ({ ...acc, ...current }),
      {}
    );

    if (Object.keys(mergedStyles).length > 0) {
      return (
        <div
          style={{
            ...mergedStyles,
            display: "inline-block",
            borderRadius: "4px",
            backgroundColor: mergedStyles.backgroundColor || "transparent",
          }}
        >
          {value}
        </div>
      );
    }

    return value; // Default case
  };

  const [sortColumn, setSortColumn] = useState<string>(uniqueKey); // Sorting based on unique key
  const [sortOrder, setSortOrder] = useState<"asc" | "desc">("desc");

  // Reverse Pagination - Start from the last page
  const lastPage = Math.max(totalPages, 1);
  const [currentPage, setCurrentPage] = useState<number>(lastPage);
  // Ensure pagination updates from last to first

  // Set initial page to the last page when totalPages is available
  useEffect(() => {
    if (totalPages > 0) {
      setPage(1); // Move to the last page initially
    }
  }, [totalPages]);

  // Add this to track if we've already initialized from preselectedItems
  const [initializedPreselection, setInitializedPreselection] = useState(false);

  // Update the useEffect that handles preselectedItems
  useEffect(() => {
    // Only set selected rows from preselectedItems if:
    // 1. We haven't initialized yet
    // 2. There are preselectedItems
    // 3. We have data loaded
    if (
      !initializedPreselection &&
      preselectedItems &&
      preselectedItems.length > 0 &&
      data.length > 0
    ) {
      const newSelectedRows = new Set(preselectedItems);
      setSelectedRows(newSelectedRows);
      onSelectionChange?.(Array.from(newSelectedRows));
      setInitializedPreselection(true); // Mark as initialized to avoid infinite loop
    }
  }, [preselectedItems, data, initializedPreselection]);

  // Sort Data Before Rendering
  const sortedData = [...data].sort((a, b) => {
    const aValue = a[sortColumn] || "";
    const bValue = b[sortColumn] || "";

    if (sortOrder === "asc") {
      return aValue > bValue ? 1 : -1;
    } else {
      return aValue < bValue ? 1 : -1;
    }
  });

  return (
    <div
      className={`py-4 rounded-xl ${
        showBorder ? "border border-neutral-700" : ""
      }`}
    >
      <div className="relative">
        {/* ✅ HEADER TABLE */}
        <Table className="table-fixed w-full">
          <TableHeader>
            <TableRow style={{ backgroundColor: headerColor }}>
              <TableHead className="text-center text-white w-[48px]">
                <Checkbox
                  checked={selectedRows.size === data.length}
                  onCheckedChange={(checked) => handleSelectAll(!!checked)}
                />
              </TableHead>
              {columns.map((column, index) => (
                <TableHead
                  key={index}
                  className="text-center text-white cursor-pointer"
                  onClick={() => {
                    setSortOrder(sortOrder === "asc" ? "desc" : "asc");
                    setSortColumn(column.key);
                  }}
                >
                  <div className="flex items-center justify-center gap-1">
                    {column.header}
                    {sortColumn === column.key &&
                      (sortOrder === "asc" ? (
                        <ChevronUp className="w-4 h-4 text-white" />
                      ) : (
                        <ChevronDown className="w-4 h-4 text-white" />
                      ))}
                  </div>
                </TableHead>
              ))}
              {showDetailsColumn && (
                <TableHead className="text-center text-white w-[80px]">
                  DETAILS
                </TableHead>
              )}
            </TableRow>

            <TableRow>
              <TableCell className="text-center w-[48px]">
                <Checkbox checked={false} disabled />
              </TableCell>
              {columns.map((column, index) => (
                <TableCell key={index} className="text-center p-2">
                  <div className="relative flex items-center max-w-[120px] mx-auto">
                    <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400 h-4 w-4 pointer-events-none" />
                    <Input
                      placeholder="Search"
                      value={searchQueries[column.key] || ""}
                      onChange={(e) =>
                        handleSearchChange(column.key, e.target.value)
                      }
                      className="pl-8 h-8 text-sm w-full"
                    />
                  </div>
                </TableCell>
              ))}
              {showDetailsColumn && (
                <TableCell className="text-center p-2 w-[80px]">
                  <div className="relative flex items-center max-w-[120px] mx-auto w-full">
                    <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-600 h-4 w-4 pointer-events-none" />
                    <Input
                      placeholder="Search"
                      disabled
                      className="pl-8 h-8 text-sm w-full"
                    />
                  </div>
                </TableCell>
              )}
            </TableRow>
          </TableHeader>
        </Table>

        {/* ✅ SCROLLABLE BODY TABLE (supports optional expandable rows) */}
        <div
          className="overflow-y-auto"
          style={{
            maxHeight: "36vh",
            scrollbarWidth: "thin",
            scrollbarColor: "#262626 transparent",
            msOverflowStyle: "-ms-autohiding-scrollbar",
          }}
        >
          <Table className="table-fixed w-full">
            <TableBody>
              {sortedData.flatMap((item, rowIndex) => {
                const hasChildren =
                  expandableKey && Array.isArray(item[expandableKey]);
                const isExpanded = expandedRows[item[uniqueKey]];

                const mainRow = (
                  <TableRow key={`${item[uniqueKey]}-main`}>
                    <TableCell className="text-center w-[48px]">
                      <div className="flex items-center justify-center">
                        <Checkbox
                          checked={selectedRows.has(item[uniqueKey])}
                          onCheckedChange={() =>
                            toggleRowSelection(item[uniqueKey])
                          }
                        />
                        {hasChildren ? (
                          <button
                            onClick={() =>
                              setExpandedRows((prev) => ({
                                ...prev,
                                [item[uniqueKey]]: !prev[item[uniqueKey]],
                              }))
                            }
                            className="ml-1 text-white"
                          >
                            {isExpanded ? <ChevronDown /> : <ChevronRight />}
                          </button>
                        ) : null}
                      </div>
                    </TableCell>

                    {columns.map((column, colIndex) => (
                      <TableCell
                        key={`${item[uniqueKey]}-${column.key}-${colIndex}`}
                        className="text-center"
                      >
                        {customCellRender(item[column.key], column.key)}
                      </TableCell>
                    ))}

                    {showDetailsColumn && (
                      <TableCell className="text-center w-[80px]">
                        <Button
                          variant="ghost"
                          className="text-neutral-400 hover:text-neutral-200"
                          onClick={() => onDetailsClick?.(item)}
                        >
                          <Edit
                            className="h-5 w-5 text-[#fafafa]"
                            strokeWidth={2}
                          />
                        </Button>
                      </TableCell>
                    )}
                  </TableRow>
                );

                const childRows =
                  isExpanded && hasChildren
                    ? item[expandableKey].map((child: any, i: number) => (
                        <TableRow key={`${item[uniqueKey]}-child-${i}`}>
                          <TableCell className="text-center w-[48px]">
                            <Checkbox
                              checked={selectedRows.has(child[uniqueKey])}
                              onCheckedChange={() =>
                                toggleRowSelection(child[uniqueKey])
                              }
                            />
                          </TableCell>
                          {columns.map((column, colIndex) => (
                            <TableCell
                              key={`${child[uniqueKey]}-${column.key}-${colIndex}`}
                              className="text-center"
                            >
                              {column.key === "workoutId"
                                ? `|________ ${customCellRender(
                                    child[column.key],
                                    column.key
                                  )}`
                                : customCellRender(
                                    child[column.key],
                                    column.key
                                  )}
                            </TableCell>
                          ))}
                          {showDetailsColumn && (
                            <TableCell className="text-center w-[80px]">
                              <Button
                                variant="ghost"
                                className="text-neutral-400 hover:text-neutral-200"
                                onClick={() => onDetailsClick?.(child)}
                              >
                                <Edit
                                  className="h-5 w-5 text-[#fafafa]"
                                  strokeWidth={2}
                                />
                              </Button>
                            </TableCell>
                          )}
                        </TableRow>
                      ))
                    : [];

                return [mainRow, ...childRows];
              })}
            </TableBody>
          </Table>
        </div>
      </div>

      {/* ✅ PAGINATION */}
      <div className="flex justify-between items-center mt-4 p-4 text-neutral-400">
        <div>
          Showing {(page - 1) * 9 + 1} to {Math.min(page * 9, totalPages * 9)}{" "}
          of {totalPages * 9} Entries
        </div>
        <div className="flex items-center divide-x divide-neutral-600">
          <Button
            variant="outline"
            onClick={handlePrevPage}
            disabled={page <= 1}
            className="rounded-r-none border-r-0 border-[#525252]"
          >
            <ChevronLeft className="h-4 w-4" />
          </Button>

          {getPaginationButtons()}

          <Button
            variant="outline"
            onClick={handleNextPage}
            disabled={page >= totalPages}
            className="rounded-l-none border-l-0 border-[#525252]"
          >
            <ChevronRight className="h-4 w-4" />
          </Button>
        </div>
      </div>
    </div>
  );
}
```

### Customization

- **Styling**: Modify table styling with `headerColor` and custom CSS classes.
- **Expandable Rows**: Add nested row support using the `expandableKey` prop.
- **Custom Cell Rendering**: Use `customStyles` for dynamic value formatting.
- **Row Actions**: Add edit or detail buttons using the `onDetailsClick` prop.
- **Selection Handling**: Monitor and respond to row selections via `onSelectionChange`.
- **Sorting & Paging**: Fine-tune default sort behavior and start page.
