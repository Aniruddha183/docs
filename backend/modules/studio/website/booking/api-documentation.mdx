---
title: "API Documentation"
---

## Booking Module

### Module Overview

Users can search for studios or sessions by **place name, city, or keyword**, and apply **filters** (such as distance, category, or session type) to refine their results. Once a suitable studio is found, the user can book:

- **Offline sessions** — Attend in-person at the selected studio
- **Online live sessions** — Join virtual classes hosted by studio owners or managers
- **Personal training sessions** — One-on-one coaching based on availability

This module centralizes all features to **simplify user effort**, offering smooth discovery, booking, payment, and review workflows.

### Key Capabilities

- **Session Types:** Support for _offline_, _online live_, and _personal_ training sessions
- **Booking Flow:** Integrated session selection, availability checking, and booking confirmation
- **Seamless User Experience:** Designed to minimize steps for booking and feedback submission

---

### Studio Booking APIs

Below are the APIs related to the **Studio Booking** within this module, allowing users to perfom all possible action that is inside the studios module.

---

## Base URL

```
/api/fitnearn/web/users/studio
```

---

## Middleware

### `idGenerationMiddleware('RCPT')`

- **Purpose**: Generates a unique Receipt ID (`RCPTxxxxx`) for new refunds
- **Usage**: Required for identifying each refund transaction

### `upload.single('attachment')`

- **Headers (for file upload)**:
  - `Authorization` (string): Bearer token (required if uploading file)
  - `x-refresh-token` (string): Refresh token (required if uploading file)
  - `x-username` (string): Username (required if uploading file)
- **Purpose**: Handles file upload using multer to S3
- **Usage**: Required for generating image/attachment URLs for queries

---

## Endpoints

### 1. Invite User

Sends invitation email to join a session.

- **Method**: `POST`
- **URL**: `/session/inviteUser`
- **Controller**: `inviteUser`
- **Request Body**:
  - `email` (string): Invitee email (required)
  - `sessionId` (string): Session identifier (required)
  - `userId` (string): User identifier (required)
  - `resend` (boolean): Whether resending invitation (optional)
  - `sessionType` (string): Type of session (required)
- **Success Response**:
  ```json
  {
    "success": true,
    "message": "Invitation sent successfully",
    "data": "invitee@example.com"
  }
  ```
- **Error Responses**:
  - `400 Bad Request`: Invalid email, missing fields, or already invited`
  - `404 Not Found`: Session not found`
  - `500 Internal Server Error`

---

### 2. Book Studio Session

Creates a new studio session booking.

- **Method**: `POST`
- **URL**: `/bookStudioSession`
- **Controller**: `bookStudioSession`
- **Request Body**:
  - `userId` (string): User identifier (required)
  - `studioId` (string): Studio identifier (required)
  - `sessionTitle` (string): Title of session (required)
  - `sessionDate` (string): Date in DD-MM-YYYY format (required)
  - `sessionTimeSlot` (string): Time slot (required)
  - `seat` (number): Number of seats (required)
  - `category` (string): Session category (required)
  - `discountAmount` (number): Discount applied (optional)
  - `discountRate` (number): Discount percentage (optional)
  - `participantsEmail` (array): List of participant emails (required)
  - `invitedEmail` (array): List of invited emails (optional)
  - `tax` (number): Tax amount (required)
  - `total` (number): Total before tax (required)
  - `grandTotal` (number): Final amount (required)
  - `paymentMode` (string): Payment method (required)
  - `orderId` (string): Payment order ID (required)
  - `transactionId` (string): Transaction ID (required)
  - `isSessionFree` (boolean): Whether session is free (optional)
- **Success Response**:
  ```json
  {
    "success": true,
    "message": "Studio Session is Booked ID :STBN00123",
    "sessionId": "STBN00123"
  }
  ```
- **Error Responses**:
  - `400 Bad Request`: Studio ID missing or date/slot passed
  - `404 Not Found`: Studio or user not found
  - `500 Internal Server Error`

---

### 3. Confirm Booking

Records payment confirmation for a booking.

- **Method**: `POST`
- **URL**: `/booking/add`
- **Controller**: `confirmBooking`
- **Request Body**:
  - `paymentId` (string): Payment gateway payment ID (required)
  - `userId` (string): User identifier (required)
  - `discountRate` (number): Discount percentage (optional, default: 0)
  - `discountAmount` (number): Discount amount (optional, default: 0)
  - `grandTotal` (number): Final amount paid (required)
  - `actualAmount` (number): Original amount (optional, default: 0)
  - `payment_mode` (string): Payment method (required)
  - `tax` (number): Tax percentage (optional, default: 0)
  - `gstAmount` (number): GST amount (optional)
  - `seats` (number): Number of seats booked (required)
  - `note` (string): Additional notes (optional)
  - `currency` (string): Currency code (required)
  - `sessionId` (string): Session identifier (required)
  - `orderId` (string): Payment order ID (required)
  - `sessionType` (string): Type of session (required)
- **Success Response**:
  ```json
  {
    "success": true,
    "data": {
      "userId": "USR00123",
      "bookingId": "BID00456",
      "orderId": "order_xyz",
      "transactionId": "TXN00789",
      "sessionId": "STBN00123",
      "sessionType": "Booking Individual",
      "grandTotal": 590,
      "payment_date": "15-01-2025",
      ...
    }
  }
  ```
- **Error Responses**:
  - `400 Bad Request`: Missing fields or session already booked
  - `404 Not Found`: Session not found
  - `409 Conflict`: Duplicate booking
  - `500 Internal Server Error`

---

### 4. Book Free Live Session

Books a free live session for a user.

- **Method**: `POST`
- **URL**: `/bookFreeLS`
- **Controller**: `bookFreeLiveSession`
- **Request Body**:
  - `userId` (string): User identifier (required)
  - `seats` (number): Number of seats (required)
  - `sessionId` (string): Session identifier (required)
  - `sessionType` (string): Type of session (optional, default: `Live Session`)
- **Success Response**:
  ```json
  {
    "success": true,
    "message": "Live session booked successfully : Morning Yoga"
  }
  ```
- **Error Responses**:
  - `400 Bad Request`: Missing fields or session already booked
  - `404 Not Found`: Session not found
  - `409 Conflict`: Duplicate booking
  - `500 Internal Server Error`

---

### 5. Get User Studio Session List

Retrieves all studio sessions for a user (upcoming or past).

- **Method**: `GET`
- **URL**: `/allSession/:userId`
- **Controller**: `userStudioSessionList`
- **URL Parameters**:
  - `userId` (string): User identifier (required)
- **Query Parameters**:
  - `status` (string): `upcoming` or `past` (optional, default: `upcoming`)
- **Success Response**:
  ```json
  {
    "success": true,
    "data": {
      "liveSessions": [
        {
          "sessionId": "LS00123",
          "sessionStartTime": "2025-01-15T10:00:00Z",
          "sessionEndTime": "2025-01-15T11:00:00Z",
          "sessionDuration": "60 Min",
          "sessionName": "Morning Yoga",
          "studioName": "Fitness Hub",
          "sessionType": "Group",
          "status": "Upcoming",
          "bookingStatus": "Confirmed",
          "amount": 500,
          "bookedAt": "14-01-2025",
          "type": "Live Session"
        }
      ],
      "studioSessions": [
        {
          "sessionId": "STBN00456",
          "sessionStartTime": "2025-01-16T14:00:00Z",
          "sessionEndTime": "2025-01-16T15:00:00Z",
          "sessionDuration": "1 Hr",
          "sessionName": "Gym Session",
          "studioName": "Power Gym",
          "sessionType": "Offline",
          "status": "Upcoming",
          "bookingStatus": "Confirmed",
          "amount": 300,
          "bookedAt": "2025-01-14T12:00:00Z",
          "type": "Studio Session"
        }
      ]
    }
  }
  ```
- **Error Responses**:
  - `404 Not Found`: User not found
  - `500 Internal Server Error`

---

### 6. Get Session Details

Retrieves detailed information about a specific booked session.

- **Method**: `GET`
- **URL**: `/session/:userId/:sessionId`
- **Controller**: `getSessionDetails`
- **URL Parameters**:
  - `userId` (string): User identifier (required)
  - `sessionId` (string): Session identifier (required)
- **Success Response**:
  ```json
  {
    "success": true,
    "data": {
      "sessionId": "STBN00123",
      "studioId": "STD00456",
      "address": "Connaught Place, Delhi",
      "sessionTitle": "Morning Workout",
      "studioName": "Fitness Hub",
      "category": "Gym",
      "sessionDate": "2025-01-15T10:00:00Z",
      "sessionTimeSlot": "10:00 AM - 11:00 AM",
      "sessionType": "Group",
      "status": "Upcoming",
      "bookedAt": "2025-01-14T12:00:00Z",
      "thumbnail": "https://...",
      "paymentMode": "Online",
      "transactionid": "TXN00789",
      "discountAmount": 50,
      "participantsEmail": ["user1@example.com", "user2@example.com"],
      "participantNames": ["John Doe", "Jane Smith"],
      "invitedEmail": ["invite@example.com"],
      "tax": 90,
      "total": 500,
      "grandTotal": 590,
      "isSessionFree": false,
      "studioOwnerName": "Owner Name",
      "seats": 2,
      "bookedSeats": 2,
      "userId": "USR00123",
      "isCreator": true,
      "bookingId": ["BID00111"],
      "cancelledDate": null,
      "cancelledReason": null,
      "cancelledBy": null,
      "bookingDetails": [...],
      "refundDetail": null,
      "qrCode": "data:image/png;base64,..."
    }
  }
  ```
- **Error Responses**:
  - `404 Not Found`: Session not found
  - `500 Internal Server Error`

---

### 7. Cancel Session Booking

Cancels a booked studio or live session.

- **Method**: `PUT`
- **URL**: `/session/cancel/:userId/:sessionId`
- **Controller**: `cancelSessionBooking`
- **URL Parameters**:
  - `userId` (string): User identifier (required)
  - `sessionId` (string): Session identifier (required)
- **Query Parameters**:
  - `sessionType` (string): `LiveSession` or studio session (optional)
- **Request Body**:
  - `reason` (string): Cancellation reason (required)
- **Success Response**:
  ```json
  {
    "success": true,
    "message": "Session cancelled successfully."
  }
  ```
- **Error Responses**:
  - `400 Bad Request`: Not creator, already cancelled, or session ongoing
  - `404 Not Found`: Booking/session not found
  - `500 Internal Server Error`

---

### 8. Generate QR Code

Generates QR code for session check-in.

- **Method**: `GET`
- **URL**: `/session/qrcode/:userId/:sessionId`
- **Controller**: `generateQRCode`
- **URL Parameters**:
  - `userId` (string): User identifier (required)
  - `sessionId` (string): Session identifier (required)
- **Success Response**:
  ```json
  {
    "success": true,
    "data": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA..."
  }
  ```
- **Error Responses**:
  - `404 Not Found`: No sessions found
  - `500 Internal Server Error`

---

### 9. Check Refund Eligibility

Checks if a session is eligible for refund (must be >24 hours before start).

- **Method**: `GET`
- **URL**: `/session/checkRefund/:userId/:sessionId`
- **Controller**: `checkRefundEligibility`
- **URL Parameters**:
  - `userId` (string): User identifier (required)
  - `sessionId` (string): Session identifier (required)
- **Query Parameters**:
  - `sessionType` (string): `LiveSession` or studio session (optional)
- **Success Response**:
  ```json
  {
    "success": true,
    "message": "Refund allowed"
  }
  ```
- **Error Responses**:
  - `400 Bad Request`: Not creator, already cancelled, or hours before session`
  - `404 Not Found`: Session not found`
  - `500 Internal Server Error`

---

### 10. Initiate Refund

Processes refund for cancelled bookings.

- **Method**: `POST`
- **URL**: `/session/initiateRefund`
- **Middleware**: `idGenerationMiddleware('RCPT')`
- **Controller**: `initiateRefund`
- **Request Body**:
  - `bookingIds` (array): Array of booking IDs to refund (required)
- **Success Response**:
  ```json
  {
    "success": true,
    "message": "refund initiated successfully"
  }
  ```
- **Error Responses**:
  - `400 Bad Request`: No booking found, already refunded, or invalid payment
  - `500 Internal Server Error`

---

### 11. List Upcoming Live Sessions

Retrieves upcoming live sessions for a studio.

- **Method**: `GET`
- **URL**: `/LS/list/:studioId`
- **Controller**: `listUpcomingSessions`
- **URL Parameters**:
  - `studioId` (string): Studio identifier (required)
- **Query Parameters**:
  - `userId` (string): User identifier for personalization (optional)
- **Success Response**:
  ```json
  {
    "success": true,
    "sessions": [
      {
        "sessionId": "LS00123",
        "status": "Approved",
        "level": "Beginner",
        "thumbnail": "https://...",
        "isLiked": false,
        "sessionName": "Morning Yoga",
        "category": "Yoga",
        "description": "Relaxing morning session",
        "date": "15-01-2025",
        "time": "10:00 AM - 11:00 AM",
        "availableSeats": 8,
        "basePrice": 500,
        "adminDiscountPercentage": 10,
        "finalPrice": 450,
        "discountPercentage": 5,
        "taxRate": 18,
        "taxAmount": 81,
        "payableAmount": 531,
        "createdAt": "2025-01-10T08:00:00Z",
        "isRegistered": false
      }
    ],
    "totalSessions": 1
  }
  ```
- **Error Responses**:
  - `404 Not Found`: No upcoming live sessions found
  - `500 Internal Server Error`

---

### 12. Get Live Session Detail

Retrieves detailed information about a live session.

- **Method**: `GET`
- **URL**: `/LS/detail/:sessionId`
- **Controller**: `getLSDetail`
- **URL Parameters**:
  - `sessionId` (string): Session identifier (required)
- **Query Parameters**:
  - `userId` (string): User identifier for personalization (optional)
- **Success Response**:
  ```json
  {
    "success": true,
    "session": {
      "sessionId": "LS00123",
      "sessionName": "Morning Yoga",
      "description": "Relaxing morning session",
      "sessionStartTime": "2025-01-15T10:00:00Z",
      "sessionEndTime": "2025-01-15T11:00:00Z",
      "sessionTime": "10:00 AM",
      "sessionDate": "15-01-2025",
      "duration": 60,
      "focusArea": ["Flexibility", "Balance"],
      "basePrice": 500,
      "adminDiscountPercentage": 10,
      "finalPrice": 450,
      "discountPercentage": 5,
      "taxRate": 18,
      "taxAmount": 81,
      "payableAmount": 531,
      "totalSeats": 10,
      "availableSeats": 8,
      "calories": 200,
      "exerciseLevel": "Beginner",
      "intensity": "Low",
      "sessionType": "Group",
      "equipment": ["Mat"],
      "category": "Yoga",
      "premium": false,
      "address": "Connaught Place, Delhi, 110001",
      "timeUntilStart": "Starts in 2 hours",
      "likes": 45,
      "shares": 12,
      "isLiked": false,
      "thumbnail": "https://...",
      "ownerName": "John Doe",
      "isBooked": false
    }
  }
  ```
- **Error Responses**:
  - `400 Bad Request`: Missing sessionId
  - `404 Not Found`: Live session not found
  - `500 Internal Server Error`

---

### 13. Get Recommended Sessions

Returns recommended live sessions based on similarity to a given session.

- **Method**: `GET`
- **URL**: `/LS/recommendation/:sessionId`
- **Controller**: `getRecommendedSessions`
- **URL Parameters**:
  - `sessionId` (string): Session identifier (required)
- **Query Parameters**:
  - `userId` (string): User identifier for personalization (optional)
- **Success Response**:
  ```json
  {
    "success": true,
    "recommendations": [
      {
        "sessionId": "LS00456",
        "thumbnail": "https://...",
        "status": "Approved",
        "isLiked": false,
        "level": "Beginner",
        "sessionName": "Evening Yoga",
        "equipment": ["Mat"],
        "description": "Calming evening session",
        "focusArea": ["Flexibility", "Relaxation"],
        "currentStatus": "Upcoming"
      }
    ]
  }
  ```
- **Error Responses**:
  - `404 Not Found`: Live session not found
  - `500 Internal Server Error`

---

### 14. Get Booked Live Session Detail

Retrieves details of a booked live session for a user.

- **Method**: `GET`
- **URL**: `/LS/booked/detail/:userId/:sessionId`
- **Controller**: `getBookedLSDetail`
- **URL Parameters**:
  - `userId` (string): User identifier (required)
  - `sessionId` (string): Session identifier (required)
- **Success Response**:
  ```json
  {
    "success": true,
    "data": {
      "userId": "USR00123",
      "sessionId": "LS00456",
      "sessionTitle": "Morning Yoga",
      "studioId": "STD00789",
      "studioName": "Fitness Hub",
      "category": "Yoga",
      "sessionDate": "15-01-2025",
      "sessionTime": "2025-01-15T10:00:00Z",
      "sessionType": "Group",
      "bookingType": "Paid",
      "thumbnail": "https://...",
      "exerciseLevel": "Beginner",
      "equipment": ["Mat"],
      "duration": "60 Min",
      "bookedAt": "14-01-2025",
      "sessionLink": "https://zoom.us/...",
      "address": "Connaught Place, Delhi",
      "isFree": false,
      "bookingIds": ["BID00111"],
      "status": "Approved",
      "cancelledDate": null,
      "cancelledReason": null,
      "cancelledBy": null,
      "booking": {
        "bookingId": "BID00111",
        "grandTotal": 531,
        ...
      },
      "refundDetail": {
        "refundId": "N/A",
        "razorpay_refund_id": "N/A",
        "refund_amount": 0,
        "refund_status": "Pending"
      },
      "qrCode": "data:image/png;base64,..."
    }
  }
  ```
- **Error Responses**:
  - `404 Not Found`: Session not found in user booked session
  - `500 Internal Server Error`

---

### 15. Report Live Session

Allows users to report a live session for inappropriate content.

- **Method**: `POST`
- **URL**: `/LS/report/:sessionId`
- **Controller**: `reportStudioLS`
- **URL Parameters**:
  - `sessionId` (string): Session identifier (required)
- **Request Body**:
  - `userId` (string): User identifier (required)
  - `reason` (string): Report reason (required)
- **Success Response**:
  ```json
  {
    "success": true,
    "message": "Session reported successfully"
  }
  ```
- **Error Responses**:
  - `400 Bad Request`: Session already reported
  - `404 Not Found`: Session/user not found
  - `500 Internal Server Error`

---

### 16. Create Query for Session

Allows users to raise a query/complaint regarding a session.

- **Method**: `POST`
- **URL**: `/raiseQuery`
- **Middleware**: `upload.single('attachment')`
- **Controller**: `createQueryForSession`
- **Request Body** (multipart/form-data):
  - `issueType` (string): Type of issue (optional, default: `Other`)
  - `message` (string): Query message (required)
  - `userId` (string): User identifier (required)
  - `referenceId` (string): Session/studio reference ID (required)
  - `attachment` (file): Supporting file (optional)
- **Success Response**:
  ```json
  {
    "success": true,
    "message": "Query submitted successfully"
  }
  ```
- **Error Responses**:
  - `400 Bad Request`: Missing required fields or duplicate query
  - `401 Unauthorized`: Missing/invali

---
