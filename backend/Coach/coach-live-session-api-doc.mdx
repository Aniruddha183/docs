---

title: "Coach Booking and Live Session API Documentation"
description: "REST API reference for Coach Booking and Live Session module."
---

# Coach Booking and Live Session

This document describes **coach-facing APIs** used to create, schedule, update, cancel, and fetch public and private live sessions. Every endpoint explicitly lists **required headers, URL params, query params, and request bodies**, and explains how the **date-time conflict algorithm** prevents overlapping sessions.

---

## Base URL

```
/api/fitnearn/web/coach
```

---

## Required Headers (all endpoints)

| Header          | Type   | Description                                               |
| --------------- | ------ | --------------------------------------------------------- |
| `Authorization` | string | Bearer JWT token identifying the coach                    |
| `Content-Type`  | string | `application/json` (or `multipart/form-data` for uploads) |

---

## Shared middleware & utilities

* `idGenerationMiddleware('LIV')` — generates unique live-session IDs
* `parseDateTime(date, time)` — converts date + time strings into JS `Date`
* `BookedSlot` — stores all booked time ranges per coach

---

## Endpoints

### 1. Create Public Live Session

* **Method**: `POST`
* **URL**: `/public/create`
* **Middleware**: `authenticateCoachToken`, `idGenerationMiddleware('LIV')`
* **Controller**: `createPublicLiveSession`

**Request Body**

```json
{
  "coachId": "COH00012",
  "title": "Yoga Flow",
  "description": "Morning yoga session",
  "date": "22-10-2025",
  "startTime": "08:00 AM",
  "duration": 60,
  "category": "Yoga"
}
```

**Functioning**

* Parses `date` and `startTime` into `newStartTime`
* Computes `newEndTime = newStartTime + duration`
* Runs conflict check against existing `BookedSlot` entries
* Creates `PublicSession` and writes slot if no conflict exists

---

### 2. Create Draft Public Session

* **Method**: `POST`
* **URL**: `/public/create-draft`
* **Middleware**: `authenticateCoachToken`
* **Controller**: `createDraftSession`

**Request Body**

```json
{
  "coachId": "COH00012",
  "title": "Draft Session",
  "category": "Strength"
}
```

**Functioning**

* Saves a session with `stage: draft`
* No time conflict checks occur at this stage

---

### 3. Add Session Time (Conflict-Checked)

* **Method**: `PATCH`
* **URL**: `/public/update-draft`
* **Middleware**: `authenticateCoachToken`
* **Controller**: `addSessionTime`

**Request Body**

```json
{
  "sessionId": "LIV00045",
  "date": "25-10-2025",
  "startTime": "10:30 AM",
  "duration": 90
}
```

**Functioning**

* Converts `date` + `startTime` using `parseDateTime`
* Computes end time from duration
* Ensures session is scheduled at least **48 hours in advance**
* Performs overlap check using:

  * `existing.start < newEnd && existing.end > newStart`
* Writes slot only if no conflict exists

---

### 4. Send Session for Admin Review

* **Method**: `PATCH`
* **URL**: `/public/send-review/:sessionId`
* **Middleware**: `authenticateCoachToken`
* **Controller**: `sendSessionForReview`

**URL Params**

| Param       | Type   | Description             |
| ----------- | ------ | ----------------------- |
| `sessionId` | string | Live session identifier |

**Functioning**

* Revalidates time conflicts
* Locks session schedule and moves stage to `UNDER_REVIEW`

---

### 5. Update Session State

* **Method**: `PATCH`
* **URL**: `/public/update-state/:sessionId`
* **Middleware**: `authenticateCoachToken`
* **Controller**: `updateState`

**URL Params**

| Param       | Type   | Description |
| ----------- | ------ | ----------- |
| `sessionId` | string | Session ID  |

**Request Body**

```json
{
  "state": "COMPLETED"
}
```

**Functioning**

* Updates lifecycle state
* Used after session completion or cancellation

---

### 6. Cancel Public Session

* **Method**: `PATCH`
* **URL**: `/cancel/public`
* **Middleware**: `authenticateCoachToken`
* **Controller**: `cancelPublicSession`

**Request Body**

```json
{
  "sessionId": "LIV00045",
  "cancelReason": "Coach unavailable"
}
```

**Functioning**

* Marks session cancelled
* Removes corresponding `BookedSlot`
* Triggers notifications and refunds if applicable

---

### 7. Cancel Private Booking

* **Method**: `PATCH`
* **URL**: `/cancel/private`
* **Middleware**: `authenticateCoachToken`
* **Controller**: `cancelPrivateBookings`

**Request Body**

```json
{
  "sessionId": "PRV00031",
  "cancelReason": "Emergency"
}
```

**Functioning**

* Cancels private booking
* Frees booked time slot
* Notifies participants

---

### 8. Get Session Details

* **Method**: `GET`
* **URL**: `/get/session-details/:sessionId`
* **Middleware**: `authenticateCoachToken`
* **Controller**: `getSessionById`

**URL Params**

| Param       | Type   | Description |
| ----------- | ------ | ----------- |
| `sessionId` | string | Session ID  |

**Functioning**

* Returns full session details
* Auto-updates expired sessions

---

### 9. Get Coach Bookings

* **Method**: `GET`
* **URL**: `/get/bookings/:coachId`
* **Middleware**: `authenticateCoachToken`
* **Controller**: `getCoachBookings`

**URL Params**

| Param     | Type   | Description      |
| --------- | ------ | ---------------- |
| `coachId` | string | Coach identifier |

**Query Params (optional)**

| Param  | Type   | Description           |
| ------ | ------ | --------------------- |
| `type` | string | `public` or `private` |

**Functioning**

* Fetches all public and private sessions for a coach

---

## Conflict Detection Algorithm (Summary)

* All session times are converted into `Date` objects
* Conflict exists if:

```text
existing.startTime < newEndTime AND existing.endTime > newStartTime
```

* Some controllers apply a **10-minute buffer** to both ends
* A minimum **48-hour advance rule** is enforced

---

## Summary Table

| Method | Endpoint                          | Description                         |
| ------ | --------------------------------- | ----------------------------------- |
| POST   | `/public/create`                  | Create public live session          |
| POST   | `/public/create-draft`            | Create draft session                |
| PATCH  | `/public/update-draft`            | Add session time (conflict checked) |
| PATCH  | `/public/send-review/:sessionId`  | Send session for review             |
| PATCH  | `/public/update-state/:sessionId` | Update session state                |
| PATCH  | `/cancel/public`                  | Cancel public session               |
| PATCH  | `/cancel/private`                 | Cancel private booking              |
| GET    | `/get/session-details/:sessionId` | Get session details                 |
| GET    | `/get/bookings/:coachId`          | Get coach bookings                  |

---
