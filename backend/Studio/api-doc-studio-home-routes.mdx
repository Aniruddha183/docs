---
title: "Home & Notifications API Documentation"
description: "REST API reference for Studio App's Home Page and Notification Management."
---

This document outlines the API endpoints available to **Studios** for home page sessions and notification management in Studio App.

## Base URL

```
/api/fitnearn/app/studio
```

## Middleware

### `authenticateStudioToken()`

- **Purpose**: Validates JWT token and authenticates studio owner requests.
- **Usage**: Required in all protected studio owner endpoints.

### `idGenerationMiddleware('QRY')`

- **Purpose**: Generates unique query IDs for issue reporting.
- **Usage**: Applied to report creation endpoints.

---

## Home Page Endpoints

### 1. Get All Sessions by Date

Retrieves all sessions for a studio owner, optionally filtered by date.

- **Method**: `GET`
- **URL**: `/allSessions/:ownerId?date=2025-06-30`
- **Middleware**: `authenticateStudioToken()`
- **Controller**: `getSessionsByDate`
- **URL Parameters**:
  - `ownerId` (string): Unique studio owner identifier (required)
- **Query Parameters** (required):
  - `date` (string): Filter sessions by specific date (ISO format or YYYY-MM-DD)
- **Success Response**:

  ```json
  {
    "success": true,
    "sessions": [
      {
        "sessionId": "SESSION001",
        "studio": "Studio Name",
        "sessionName": "Cardio Session",
        "category": "Cardio",
        "sessionStartTime": "Date",
        "bookedSeats": 10,
        "sessionType": "Online","Offline"
        "status": "Completed"
        "sessionLevel": "Low"
      }
    ],
    "totalSessions": 15
    "message":"Sessions fetched successfully for the given date"
  }
  ```

```
- **Error Responses**:
  - `400 Not Found`: Date query parameter is required
  - `404 Not Found`: No sessions found for this owner
  - `500 Internal Server Error`
```

---

### 2. Verify QR Code

Verifies a QR code for a specific session to authenticate user check-in.

- **Method**: `GET`
- **URL**: `/verifyQR/:sessionId`
- **Middleware**: `authenticateStudioToken()`
- **Controller**: `verifyQRCode`
- **URL Parameters**:
  - `sessionId` (string): Unique session identifier (required)
- **Query Parameters** (required):
  - `userId` (string): userId i.e booked by user
  - `type` (string): session type (e.g "booking" or "liveSession")
  - `ownerId` (string): ownerId to validate the verifier
- **Success Response**:

  ```json
  {
    "success": true,
    "QRSatus": "Upcoming",
    "data": {
      "sessionId": "SESSION001",
      "studioName": "Fitflex Studio",
      "city": "New Delhi",
      "category": "Cardio",
      "sessionTitle": "Cardio Session"
      "sessionDate": "24-11-2025"
      "sessionTimeSlot": "05-06 PM"
      "status": "Upcoming"
      "participantsEmail": [
        "abhinav.maurya@fitnearn.com"
        "abhishek.kushwaha@fitnearn.com"
      ]
    }
  }
  ```

- **Error Responses**:
  - `400 Bad Request`: Invalid or expired QR code
  - `404 Not Found`: Session not found
  - `500 Internal Server Error`

---

### 3. Report an Issue

Allows studio owners to report issues or queries to the support team.

- **Method**: `POST`
- **URL**: `/report/:ownerId`
- **Middleware**: `authenticateStudioToken()`, `idGenerationMiddleware('QRY')`
- **Controller**: `reportAnIssue`
- **URL Parameters**:
  - `ownerId` (string): Unique studio owner identifier (required)
- **Request Body**:

  - `report` (string): report message provided by owner (required)

- **Success Response**:

  ```json
  {
    "success": true,
    "message": "Your Issues has been sent successfully",
    "query": {...queryObject},
  }
  ```

- **Error Responses**:
  - `400 Bad Request`: Missing required fields
  - `404 Not Found`: Owner not found
  - `500 Internal Server Error`

---

## Notification Endpoints

### 1. Toggle Notifications

Enables or disables notifications for a studio owner.

- **Method**: `PATCH`
- **URL**: `/notifications/toggle/:ownerId`
- **Middleware**: `authenticateStudioToken()`
- **Controller**: `notificationToggle`
- **URL Parameters**:
  - `ownerId` (string): Unique studio owner identifier (required)
- **Query Params**:

  - `fcmToken` (string | null): fcmToken of Studio App or null (required)

- **Success Response**:

  ```json
  {
    "success": true,
    "message": "Notifications toggle updated"
  }
  ```

- **Error Responses**:
  - `404 Not Found`: Owner not found
  - `500 Internal Server Error`

---

### 2. Get Notifications

Retrieves all notifications for a studio owner.

- **Method**: `GET`
- **URL**: `/notifications/:ownerId`
- **Middleware**: `authenticateStudioToken()`
- **Controller**: `getNotifications`
- **URL Parameters**:
  - `ownerId` (string): Unique studio owner identifier (required)
- **Query Parameters** (optional):
  - `page` (number): Page number for pagination (default: 1)
  - `limit` (number): Number of notifications per page (default: 20)
  - `unreadOnly` (boolean): Filter to show only unread notifications
- **Success Response**:

  ```json
  {
    "success": true,
    "notifications": [
      {
        "notificationId": "NOTIF001",
        "title": "New Booking",
        "message": "You have a new booking for 09:00 AM slot",
        "type": "Booking",
        "isRead": false,
        "createdAt": "2025-11-14T08:30:00Z"
      }
    ]
  }
  ```

- **Error Responses**:
  - `404 Not Found`: No notifications found
  - `500 Internal Server Error`

---

### 3. Mark Notification as Read

Marks one or multiple notifications as read.

- **Method**: `PATCH`
- **URL**: `/notifications/mark-as-read`
- **Middleware**: `authenticateStudioToken()`
- **Controller**: `markNotificationAsRead`
- **Request Body**:
  - `notificationId` (string): notification ID to mark as read (required)
  - `ownerId` (string): ownerID of studio owner (required)
- **Success Response**:

  ```json
  {
    "success": true,
    "message": "Notifications marked as read",
    "updatedCount": 5
  }
  ```

- **Error Responses**:
  - `400 Bad Request`: Invalid notification IDs
  - `500 Internal Server Error`

---

### 4. Clear All Notifications

Deletes all notifications for a studio owner.

- **Method**: `DELETE`
- **URL**: `/notifications/clear/:ownerId`
- **Middleware**: `authenticateStudioToken()`
- **Controller**: `flushNotification`
- **URL Parameters**:
  - `ownerId` (string): Unique studio owner identifier (required)
- **Success Response**:

  ```json
  {
    "success": true,
    "message": "All notifications cleared successfully",
    "deletedCount": 45
  }
  ```

- **Error Responses**:
  - `404 Not Found`: Owner not found
  - `500 Internal Server Error`

---

## Payment Endpoints

### 1. Get Completed Sessions

Retrieves all completed sessions for a studio owner that are eligible for payment.

- **Method**: `GET`
- **URL**: `/payments/:ownerId`
- **Middleware**: `authenticateStudioToken()`
- **Controller**: `completedSessions`
- **URL Parameters**:
  - `ownerId` (string): Unique studio owner identifier (required)
- **Query Parameters** (optional):
  - `page` (number): Page number for pagination (default: 1)
  - `limit` (number): Number of sessions per page (default: 20)
  - `sessionType` (string): Filter by session type ("Live Session", "Booked Session")
  - `paymentStatus` (string): Filter by payment status ("Pending", "In Progress", "Completed")
- **Success Response**:

```json
{
  "success": true,
  "data":{
    "request": [
      {
      "sessionId": "SESSION001",
      "sessionTitle": "Morning Yoga Class",
      "sessionType": "Booked Session",
      "studioName": "Fitness Hub",
      "amount": 500,
      "completedAt": "2025-11-14T10:00:00Z",
      "paymentStatus": "Pending"
      }
    ]
    "pending": [
      {
      "sessionId": "SESSION001",
      "sessionTitle": "Morning Yoga Class",
      "sessionType": "Booked Session",
      "studioName": "Fitness Hub",
      "amount": 500,
      "completedAt": "2025-11-14T10:00:00Z",
      "paymentStatus": "Pending"
      }
    ]
    "history": [
      {
      "sessionId": "SESSION001",
      "sessionTitle": "Morning Yoga Class",
      "sessionType": "Booked Session",
      "studioName": "Fitness Hub",
      "amount": 500,
      "completedAt": "2025-11-14T10:00:00Z",
      "paymentStatus": "Pending"
      }
    ]
  }
}
```

- **Error Responses**:
  - `404 Not Found`: No completed sessions found
  - `500 Internal Server Error`

---

### 2. Get Transaction Detail

Retrieves detailed information about a specific session transaction, including payment status and session details.

- **Method**: `GET`
- **URL**: `/payments/detail/:sessionId`
- **Middleware**: `authenticateStudioToken()`
- **Controller**: `transactionDetail`
- **URL Parameters**:
  - `sessionId` (string): Unique session identifier (required)
- **Query Parameters**:
  - `type` (string): Session type - "Live Session" or "Booked Session" (required)
- **Success Response (Live Session)**:

```json
{
  "success": true,
  "data": {
    "sessionId": "SESSION001",
    "bookingType": "Live",
    "title": "Morning Yoga Class",
    "sessionTimeSlot": "09:00 AM - 10:00 AM",
    "thumbnail": "https://example.com/image.jpg",
    "duration": "60",
    "sessionStartTime": "2025-11-14T09:00:00Z",
    "city": "Online",
    "address": "Virtual Room",
    "sessionPlace": "Online",
    "status": "Completed",
    "createdAt": "2025-11-10T08:00:00Z",
    "type": "Live Session",
    "hasUserAttended": null,
    "txnDetail": {
      "requestedAmount": 500,
      "txnId": "TXN123456",
      "paymentDate": "2025-11-15T10:00:00Z",
      "paymentStatus": "Completed"
    }
  }
}
```

- **Error Responses**:
  - `400 Bad Request`: sessionId & type is required / Invalid session type
  - `404 Not Found`: Session not found
  - `500 Internal Server Error`

---

### 3. Request Payment

Raises a payment request for a completed session. This endpoint creates a payment request record and updates the session status to "Payment Pending".

- **Method**: `POST`
- **URL**: `/paymentRequest/:sessionId`
- **Middleware**: `authenticateStudioToken()`
- **Controller**: `paymentRequest`
- **URL Parameters**:
  - `sessionId` (string): Unique session identifier (required)
- **Query Parameters**:
  - `type` (string): Session type - "Live Session" or "Booked Session" (required)
- **Request Flow**:
  - Validates session existence and type
  - Checks studio owner KYC verification status
  - Calculates payment amount based on session type
  - Creates payment request record with unique payment ID
  - Updates session status to "Payment Pending"
- **Success Response**:

```json
{
  "success": true,
  "message": "Your payment request has been raised. It will be processed in next 2â€“4 business days."
}
```

- **Error Responses**:
  - `400 Bad Request`: sessionId and type are required / Invalid session type / Owner KYC is not verified
  - `404 Not Found`: Live session not found / Booked session not found / Owner not found
  - `409 Conflict`: Payment requested already accepted / Your account is deleted
  - `500 Internal Server Error`

---

## File Upload Endpoints

### 1. Get Presigned URLs for Images

Generates presigned URLs for direct client-side file uploads to S3. This enables secure file uploads without routing files through the server.

- **Method**: `POST`
- **URL**: `/getPresignedUrls`
- **Middleware**: None (public endpoint)
- **Controller**: `getPresignedUrlsForImages`
- **Request Body**:

  - `ownerId` (string): Unique studio owner identifier (required)
  - `fileMetadata` (array): Array of file metadata objects (required)
    - `fileName` (string): Name of the file
    - `mimeType` (string): MIME type of the file (e.g., "image/jpeg", "image/png")
  - `folderName` (string): S3 folder name for organization (default: "Studio") (optional)

- **Example Request**:

```json
{
  "ownerId": "OWN001",
  "folderName": "StudioImages",
  "fileMetadata": [
    {
      "fileName": "studio-front.jpg",
      "mimeType": "image/jpeg"
    },
    {
      "fileName": "studio-interior.png",
      "mimeType": "image/png"
    }
  ]
}
```

- **Success Response**:

```json
{
  "success": true,
  "message": "Presigned URLs generated successfully",
  "uploadUrls": [
    {
      "fileName": "studio-front.jpg",
      "mimeType": "image/jpeg",
      "uploadUrl": "https://s3.amazonaws.com/bucket/path?signature=...",
      "publicUrl": "https://s3.amazonaws.com/bucket/path/studio-front.jpg",
      "key": "Studio/OWN001/studio-front.jpg"
    },
    {
      "fileName": "studio-interior.png",
      "mimeType": "image/png",
      "uploadUrl": "https://s3.amazonaws.com/bucket/path?signature=...",
      "publicUrl": "https://s3.amazonaws.com/bucket/path/studio-interior.png",
      "key": "Studio/OWN001/studio-interior.png"
    }
  ]
}
```

- **Error Responses**:
  - `400 Bad Request`: OwnerId is required / File metadata is required
  - `500 Internal Server Error`

---

## KYC Management Endpoints

### 1. Upload KYC Identity Documents

Uploads and encrypts KYC documents including selfie, ID proof front, and ID proof back images. Supports both initial KYC submission and re-KYC processes.

- **Method**: `POST`
- **URL**: `/kyc/idsUpload`
- **Middleware**: `authenticateStudioToken()`, `upload.fields()`
- **Controller**: `encryptOwnerImageData`
- **Content-Type**: `multipart/form-data`
- **Headers**:
  - `Authorization` (string): Bearer token (required)
  - `x-refresh-token` (string): Refresh token for AWS Cognito (required)
  - `x-username` (string): Cognito username (required)
- **Form Fields**:

  - `ownerId` (string): Unique studio owner identifier (required)
  - `tag` (string): Document type - "IDProof" or "PAN" (required)
  - `nationality` (string): Owner's nationality - "Indian" or "Foreigner" (required)
  - `nature` (string): Upload nature - "kyc" or "rekyc" (optional)
  - `selfieImage` (file): Selfie image of the owner (required)
  - `frontImage` (file): Front side of ID document (required)
  - `backImage` (file): Back side of ID document (required)

- **File Requirements**:

  - Supported formats: JPEG, PNG, PDF
  - Maximum file size: 2MB As configured in upload middleware
  - Images are encrypted before storage

- **Success Response**:

```json
{
  "success": true,
  "message": "Documents uploaded securely"
}
```

- **Error Responses**:

  - `400 Bad Request`: No file uploaded / Owner Id missing
  - `401 Unauthorized`: Authorization Token Missing / Missing Refresh token or username
  - `404 Not Found`: Your account doesn't exist anymore
  - `409 Conflict`: Your account is deleted
  - `500 Internal Server Error`: Image upload failed / Session expired, please log in again

- **Process Flow**:
  1. Validates uploaded files and authentication tokens
  2. Checks owner account status
  3. Uploads selfie image (if provided) to S3 via Cognito integration
  4. Encrypts and uploads ID document images to S3
  5. Stores encryption metadata (IV, auth tag, encrypted key)
  6. Updates or creates KYC profile with document URLs and keys
  7. Sets KYC stage to "Under Review"

---

### 2. Add KYC Banking Details

Adds encrypted banking or payment details to complete the KYC process. Supports both Indian bank accounts and international PayPal accounts.

- **Method**: `PATCH`
- **URL**: `/kyc/addkycdetails`
- **Middleware**: `authenticateStudioToken()`
- **Controller**: `addKYCDetails`
- **Request Body (Indian Nationality)**:

  - `ownerId` (string): Unique studio owner identifier (required)
  - `ifscCode` (string): Bank IFSC code (required for Indian)
  - `accountNumber` (string): Bank account number (required for Indian)
  - `accountHolderName` (string): Name on bank account (required)
  - `phoneNumber` (string): Contact phone number (required)

- **Request Body (Foreign Nationality)**:

  - `ownerId` (string): Unique studio owner identifier (required)
  - `payPalId` (string): PayPal account ID/email (required for Foreigner)
  - `currency` (string): Preferred currency code (e.g., "USD", "EUR") (required for Foreigner)
  - `phoneNumber` (string): Contact phone number (required)

- **Example Request (Indian)**:

```json
{
  "ownerId": "OWN001",
  "ifscCode": "SBIN0001234",
  "accountNumber": "1234567890",
  "accountHolderName": "John Doe",
  "phoneNumber": "+919876543210"
}
```

- **Example Request (Foreigner)**:

```json
{
  "ownerId": "OWN001",
  "payPalId": "johndoe@example.com",
  "currency": "USD",
  "phoneNumber": "+1234567890"
}
```

- **Success Response**:

```json
{
  "success": true,
  "message": "KYC details added, Sent for review"
}
```

- **Error Responses**:

  - `400 Bad Request`: Invalid nationality
  - `404 Not Found`: Your account doesn't exist anymore
  - `409 Conflict`: Your account is deleted
  - `500 Internal Server Error`: Session expired, please log in again

- **Security Features**:
  - Bank account numbers encrypted using AES encryption
  - IFSC codes encrypted using AES encryption
  - PayPal IDs encrypted using AES encryption
  - All sensitive data stored in encrypted format
  - Currency set to "INR" by default for Indian accounts

---

## Encryption & Security

### Document Encryption

- All ID documents encrypted using AES-256-GCM
- Unique encryption key generated per document
- Encryption metadata stored separately:
  - `iv`: Initialization Vector
  - `authTag`: Authentication Tag
  - `encryptedKey`: Encrypted encryption key

### Banking Data Encryption

- Account numbers encrypted using AES encryption with secret key
- IFSC codes encrypted using AES encryption
- PayPal IDs encrypted using AES encryption
- Encryption keys stored securely in environment variables

## Business Rules

1. **KYC Verification Required**: Studio owner must have verified KYC to raise payment requests
2. **Account Status**: Owner account must not be deleted
3. **Duplicate Prevention**: Cannot raise payment request if one already exists for the session
4. **Processing Time**: Payments are processed within 2-4 business days
5. **Unique Payment ID**: Each payment request receives a unique ID with prefix "PID"
6. **Payment requests**: Payment Request can only be raised for completed sessions

---
