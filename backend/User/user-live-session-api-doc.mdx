---

title: "User Live Session (Public Session) API Documentation"
description: "REST API reference for user-facing Public Live Session endpoints (bookings, seats, attendance, like/share/report, meetlink and refunds)."
---

# User Live Session (Public Session)

This document describes **only** the public-session routes you supplied. Each endpoint lists required headers, params, example request body (when applicable), a short functioning description (what it does and how), example success shape and common errors.

---

## Base URL

Routes use full paths as defined in the router. Example base segments used here:

```
/api/fitnearn/web/users/session
/api/fitnearn/web/user/session
/api/fitnearn/web/user/seats
/api/fitnearn/web/users
```

---

## Required headers

* `Authorization: Bearer <token>` — required for endpoints that need the authenticated user (likes, attend, add-participant, cancel, refunds, upcoming/past/get). Some listing endpoints (getAllPublicSessions) work without auth but will return fewer personalized fields.
* `Content-Type: application/json` for JSON bodies.

---

## Models referenced (selected)

* `PublicSession` — session metadata: `sessionId`, `title`, `description`, `coachId`, `date`, `startTime`, `endTime`, `seats`, `bookedSeats`, `meetingLink`, `status`.
* `UserBooking` / `UserBookedSession` — per-user booking record with `sessionId`, `bookingId`, `userId`, `orderId`, `paymentId`, `status`.
* `BookedSlot` — used by seat/time availability checks.

---

## Endpoints

### 1) Cancel User Public Session

* **Method**: `POST`
* **URL**: `/api/fitnearn/web/users/session/public/cancel`
* **Headers**: `Authorization: Bearer <token>`
* **Body (example)**

```json
{ "sessionId": "LIV00045", "userId": "USR00123", "cancelReason": "Emergency" }
```

**Functioning**

* Validates booking belongs to the `userId`.
* Updates booking record status to `cancelled`, decrements `PublicSession.bookedSeats` and optionally triggers refund eligibility / refund job.
* Returns cancellation confirmation and refund eligibility summary.

**Example success**

```json
{ "success": true, "message": "Session cancelled", "refundEligible": true }
```

**Common errors**: `400` too late to cancel, `404` booking not found, `500` server error.

---

### 2) Like & Dislike Session

* **Method**: `PATCH`
* **URL**: `/api/fitnearn/web/user/session/like/:sessionId`
* **Headers**: `Authorization: Bearer <token>`
* **URL Params**: `sessionId`
* **Body (example)**

```json
{ "action": "add" } // or "remove"
```

**Functioning**

* Adds or removes the authenticated user's id from `PublicSession.likedUsers`, increments/decrements `PublicSession.likes`.
* Returns `{ isLiked, likes }` for current state.

**Common errors**: `400` invalid action, `404` session not found.

---

### 3) Add Participants to a Public Session

* **Method**: `PATCH`
* **URL**: `/api/fitnearn/web/users/session/add-participant`
* **Headers**: `Authorization: Bearer <token>`
* **Body (example)**

```json
{ "sessionId": "LIV00045", "participants": ["a@b.com","c@d.com"], "userId": "USR00123" }
```

**Functioning**

* For each email: validate format, check registration (optional), add to `PublicSession.participantEmail` using `$addToSet`, and increment `bookedSeats` accordingly.
* If seats are insufficient, operation fails with `409` and no partial adds (controller may be transactional or rollbacks applied).
* Sends invites/notifications with meeting link if session has `meetingLink`.

**Common errors**: `409` insufficient seats, `404` session not found.

---

### 4) Share Session

* **Method**: `PATCH`
* **URL**: `/api/fitnearn/web/user/session/share/:sessionId`
* **Headers**: optional `Authorization`
* **URL Params**: `sessionId`
  **Functioning**
* Increments `PublicSession.shareCount` or logs a share event for analytics. If authenticated, also logs who shared.
* Lightweight endpoint; returns updated `shareCount`.

**Common errors**: `404` session not found.

---

### 5) Report Session (abuse)

* **Method**: `PATCH`
* **URL**: `/api/fitnearn/web/user/session/report/:sessionId`
* **Middleware**: `idGenerationMiddleware('RPTABUSE')` (report id generator)
* **Headers**: `Authorization: Bearer <token>`
* **URL Params**: `sessionId`
* **Body (example)**

```json
{ "reporterId": "USR00123", "reason": "inappropriate content", "details": "..." }
```

**Functioning**

* Creates a report record with generated id, stores reason and reporter metadata, flags the session for moderation.
* Returns report id and confirmation.

**Common errors**: `400` missing reason, `404` session not found.

---

### 6) Check Session MeetLink & Refund Flow

* **Method**: `PATCH`
* **URL**: `/api/fitnearn/web/user/session/meetlink/:sessionId`
* **Headers**: optional `Authorization`
* **URL Params**: `sessionId`
* **Body (example)**

```json
{ "userId":"USR00123", "meetingLink": "https://meet.example/abc123" }
```

**Functioning**

* Validates the provided `meetingLink` against stored `PublicSession.meetingLink` and checks access rights.
* If link invalid or session not started, may mark user booking for refund eligibility depending on business rules. Returns `{ valid: boolean, refundEligible: boolean }`.

**Common errors**: `403` access denied, `404` session not found.

---

### 7) Attend Session (increment attendance)

* **Method**: `PATCH`
* **URL**: `/api/fitnearn/web/user/session/attend/:sessionId`
* **Headers**: `Authorization: Bearer <token>`
* **URL Params**: `sessionId`
* **Body (optional)**

```json
{ "userId": "USR00123" }
```

**Functioning**

* Marks the user's attendance for the session and increments attendance metrics. Useful for rewards or analytics.
* Typically guarded by time window checks (only increment during session or within X minutes after start).

**Common errors**: `400` outside attendance window, `404` session not found.

---

### 8) Check Refund Eligibility

* **Method**: `GET`
* **URL**: `/api/fitnearn/web/users/session/refund/:sessionId`
* **Headers**: `Authorization: Bearer <token>`
* **URL Params**: `sessionId`
  **Functioning**
* Returns refund eligibility and amount (full/partial/none) based on cancellation policy, session time vs cutoff, and booking/payment state.

**Example success**

```json
{ "eligible": true, "refundAmount": 150.0 }
```

**Common errors**: `404` booking/session not found.

---

### 9) Get User Upcoming Sessions

* **Method**: `GET`
* **URL**: `/api/fitnearn/web/users/session/upcoming/:userId`
* **Headers**: `Authorization: Bearer <token>`
* **URL Params**: `userId`
* **Query params (optional)**: `page`, `limit`
  **Functioning**
* Returns upcoming sessions for the user (both public & private) including session meta and booking info. Enriches with `canJoin`, `meetingLink` (if allowed), and `isBooked` flags.

**Common errors**: `403` when token user mismatch, `404` none found.

---

### 10) Get User Past Sessions

* **Method**: `GET`
* **URL**: `/api/fitnearn/web/users/session/past/:userId`
* **Headers**: `Authorization`
* **URL Params**: `userId`
  **Functioning**
* Returns completed or cancelled sessions for the user with attendance and payment summaries.

---

### 11) Get All User Bookings

* **Method**: `GET`
* **URL**: `/api/fitnearn/web/users/session/get/:userId`
* **Headers**: `Authorization`
* **URL Params**: `userId`
  **Functioning**
* Aggregates all bookings for the user (upcoming, past, cancelled) and returns minimal per-booking fields for lists.

---

### 12) Get Session By SessionId

* **Method**: `GET`
* **URL**: `/api/fitnearn/web/users/session/:sessionId`
* **Headers**: optional `Authorization` — when present, returns user-specific flags
* **URL Params**: `sessionId`
  **Functioning**
* Returns full session details including coach info, seat counts, booking status for caller (if booked), `isLiked` (if auth), and whether user can join.

---

### 13) Check Public Live Session Seats (availability)

* **Method**: `GET`
* **URL**: `/api/fitnearn/web/user/seats/:sessionId`
* **Headers**: optional `Authorization`
* **URL Params**: `sessionId`
* **Query params**: `date` (DD-MM-YYYY), `timeSlot` (HH:mm-HH:mm) — depends on implementation
  **Functioning**
* Returns seat availability and whether the requested timeslot is free. Uses `BookedSlot` and current `PublicSession.bookedSeats` to compute availability.

**Common errors**: `400` invalid params.

---

### 14) Get User Cancelled Sessions

* **Method**: `GET`
* **URL**: `/api/fitnearn/web/users/cancelled-sessions/:userId`
* **Headers**: `Authorization`
* **URL Params**: `userId`
  **Functioning**
* Returns sessions the user had cancelled or that were cancelled for them, with `cancelReason` and `refundStatus`.

---

### 15) Get All Public Sessions (listing)

* **Method**: `GET`
* **URL**: `/api/fitnearn/web/user/session/public/get`
* **Headers**: optional `Authorization`
* **Query params**: `page`, `limit`, `category`, `from`, `to`, `sort`
  **Functioning**
* Returns paginated list of public sessions available for booking. If `Authorization` present, includes personalized flags (`isBooked`, `isLiked`).

---

## Notes & Implementation considerations

* All authenticated endpoints must verify the token maps to the `userId` in the request when present — return `403` on mismatch.
* Seat/availability checks must be consistent with `BookedSlot` to avoid overbooking — use DB-level atomic ops or transactions on check-and-reserve flows.
* Refund eligibility and meetlink validation rules are business-specific; controllers return clear `reason` fields on rejection.

---

## Summary Table

| Method | Endpoint                            | Purpose                          |
| ------ | ----------------------------------- | -------------------------------- |
| POST   | `/public/cancel`                    | Cancel a user's public booking   |
| PATCH  | `/user/session/like/:sessionId`     | Like/dislike session             |
| PATCH  | `/users/session/add-participant`    | Add participants to session      |
| PATCH  | `/user/session/share/:sessionId`    | Share session (analytics)        |
| PATCH  | `/user/session/report/:sessionId`   | Report session (abuse)           |
| PATCH  | `/user/session/meetlink/:sessionId` | Validate meetLink / refund check |
| PATCH  | `/user/session/attend/:sessionId`   | Increment attendance             |
| GET    | `/users/session/refund/:sessionId`  | Check refund eligibility         |
| GET    | `/users/session/upcoming/:userId`   | Get user's upcoming sessions     |
| GET    | `/users/session/past/:userId`       | Get user's past sessions         |
| GET    | `/users/session/get/:userId`        | Get all bookings for user        |
| GET    | `/users/session/:sessionId`         | Get session details              |
| GET    | `/user/seats/:sessionId`            | Check seats / timeslot           |
| GET    | `/users/cancelled-sessions/:userId` | Get user's cancelled sessions    |
| GET    | `/user/session/public/get`          | List public sessions             |

---
