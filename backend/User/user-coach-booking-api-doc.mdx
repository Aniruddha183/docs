---

title: "User Coach Booking (Private Booking) API Documentation"
description: "REST API reference for private booking endpoints (book private sessions, invites, seats, participants, conflict checks)."
---

# User Coach Booking (Private Booking)

This document describes **only** the coach booking / private-session routes you supplied. Each endpoint lists required headers, params, example request body (when applicable), a short functioning description (what it does and how), example success shape and common errors.

---

## Base URL

Routes use full paths as defined in the router, for example:

```
/api/fitnearn/web/users/session/private
/api/fitnearn/web/users/session
/api/fitnearn/web/users/coach
/api/fitnearn/web/user
```

---

## Required headers

* `Authorization: Bearer <token>` — required for authenticated user/coach actions.
* `Content-Type: application/json`.

---

## Models referenced (selected)

* `PrivateSession` — `sessionId`, `coachId`, `creatorUserId`, `participantEmail[]`, `seats`, `bookedSeats`, `meetingLink`, `startTime`, `endTime`, `status`, `payment`.
* `BookedSlot` — per-coach schedule registry used for conflict detection.
* `UserBookedSession` — per-user mapping of booked sessions.

---

## Endpoints

### 1) Check Conflicting Session (coach)

* **Method**: `GET`
* **URL**: `/api/fitnearn/web/users/coach/check-conflict/:coachId`
* **Headers**: optional `Authorization`
* **URL Params**: `coachId`
* **Query params (typical)**: `date=DD-MM-YYYY`, `startTime=HH:mm`, `duration=minutes` OR `timeSlot=HH:mm-HH:mm`

**Functioning**

* Parses requested interval to `newStartTime`/`newEndTime` and runs overlap check against `BookedSlot` for `coachId`:
  `existing.start < newEnd && existing.end > newStart`.
* Returns `{ conflict: boolean, conflictingSlots: [...] }`.

**Common errors**: `400` invalid inputs, `404` coach not found.

---

### 2) Delete Live Session (user-facing)

* **Method**: `POST`
* **URL**: `/api/fitnearn/web/users/session/delete/:sessionId`
* **Headers**: `Authorization`
* **URL Params**: `sessionId`
* **Body (optional)**

```json
{ "userId": "USR00123", "reason": "owner remove" }
```

**Functioning**

* Deletes a session (draft or allowed deletable session). Cleans up `BookedSlot` entries and associated invites/participant records.
* When session is published/has bookings, the controller may prevent deletion and return `400` or route to cancel flow.

**Common errors**: `403` not allowed, `404` not found.

---

### 3) Book Private Session (create)

* **Method**: `POST`
* **URL**: `/api/fitnearn/web/users/session/private/book`
* **Middleware**: `idGenerationMiddleware('LSX')` (generates private session id)
* **Headers**: `Authorization`
* **Body (example)**

```json
{
  "coachId": "COH00012",
  "userId": "USR00123",
  "date": "25-10-2025",
  "timeSlot": "10:00-11:00",
  "participants": ["invitee@example.com"],
  "payment": { "orderId": "ORD987", "paymentId": "PAY333" }
}
```

**Functioning**

* Validates lead-time (private bookings typically require >= 12 hours advance), parses `timeSlot`, checks conflict via `BookedSlot`.
* If clear, reserves slot (inserts to `BookedSlot`), creates `PrivateSession` with `status: booked`, generates meeting link, updates `UserBookedSession` and notifies participants.

**Success**: returns newly created `PrivateSession` with `sessionId`, `meetingLink`, and booking metadata.

**Errors**: `409` conflict, `400` lead-time violation, `500` payment failure.

---

### 4) Cancel Private Session (user)

* **Method**: `POST`
* **URL**: `/api/fitnearn/web/users/session/private/cancel`
* **Headers**: `Authorization`
* **Body (example)**

```json
{ "sessionId": "PRV00031", "userId": "USR00123", "cancelReason": "Emergency" }
```

**Functioning**

* Marks `PrivateSession` as cancelled, frees `BookedSlot` slot(s), updates `UserBookedSession`, triggers refund flows if applicable, notifies coach and participants.

**Errors**: `400` cancellation window missed, `404` session not found.

---

### 5) Invite User to Live Session

* **Method**: `POST`
* **URL**: `/api/fitnearn/web/users/session/invite`
* **Headers**: `Authorization`
* **Body (example)**

```json
{ "sessionId": "LIV00045", "inviterId": "USR00123", "inviteEmail": "friend@example.com", "role": "participant" }
```

**Functioning**

* Creates invite record with optional expiry token, pushes email to `invitedEmails`, sends invite email containing accept link. Acceptance flow adds to participants and `UserBookedSession`.

**Errors**: `409` already invited, `404` session not found.

---

### 6) Add Seats to Session

* **Method**: `PATCH`
* **URL**: `/api/fitnearn/web/users/session/add-seat/:sessionId`
* **Headers**: `Authorization`
* **URL Params**: `sessionId`
* **Body (example)**

```json
{ "userId": "USR00123", "count": 2 }
```

**Functioning**

* Adds `count` seats to the session's available pool (or records seat purchase), updates `seats`/`bookedSeats`, and writes entries to `UserBookedSession` as needed.

**Errors**: `400` exceeds allowed limit, `404` session not found.

---

### 7) Remove Participant

* **Method**: `PATCH`
* **URL**: `/api/fitnearn/web/users/session/remove-participant`
* **Headers**: `Authorization`
* **Body (example)**

```json
{ "sessionId": "PRV00031", "email": "participant@example.com", "userId": "USR00123" }
```

**Functioning**

* Removes participant email from `PrivateSession.participantEmail`, decrements `bookedSeats`, removes `UserBookedSession` mapping, and notifies participant.

**Errors**: `400` participant not found, `403` not permitted.

---

### 8) Add Participants (private route shared)

* **Method**: `PATCH`
* **URL**: `/api/fitnearn/web/users/session/add-participant`
* **Headers**: `Authorization`
* **Body (example)**

```json
{ "sessionId": "PRV00031", "participants": ["a@b.com","c@d.com"], "userId": "USR00123" }
```

**Functioning**

* Validates sessions type and seat availability, `$addToSet` adds participants, updates `bookedSeats` and `UserBookedSession` for any registered users, and sends notifications.

**Errors**: `409` insufficient seats, `404` session not found.

---

### 9) Remove Invited User

* **Method**: `PATCH`
* **URL**: `/api/fitnearn/web/users/session/remove-invited`
* **Headers**: `Authorization`
* **Body (example)**

```json
{ "sessionId": "PRV00031", "inviteEmail": "friend@example.com", "userId": "USR00123" }
```

**Functioning**

* Removes pending invite from session's `invitedEmails` array. Does not affect confirmed participants. Optionally notifies invitee of removal.

**Errors**: `404` invite not found.

---

### 10) Check Session Email (participant list)

* **Method**: `GET`
* **URL**: `/api/fitnearn/web/users/session/email/:sessionId`
* **Headers**: `Authorization`
* **URL Params**: `sessionId`

**Functioning**

* Returns lists: `participantEmail[]`, `invitedEmails[]` and maps registered emails to `userId` when possible.

**Errors**: `404` session not found.

---

### 11) Search Emails (is email registered)

* **Method**: `GET`
* **URL**: `/api/fitnearn/web/user/search-email`
* **Headers**: optional `Authorization`
* **Query params**: `email=<email>`

**Functioning**

* Returns `{ registered: boolean, userId?: string, profile?: {...} }` if the email matches a registered account.

**Errors**: `400` missing email.

---

### 12) Get All Private Sessions

* **Method**: `GET`
* **URL**: `/api/fitnearn/web/user/session/private/get`
* **Headers**: optional `Authorization`
* **Query params**: `page`, `limit`, `from`, `to`, `coachId`, `status`

**Functioning**

* Returns paginated list of private sessions (for browsing or coach dashboard). Includes coach info and whether the requesting user has joined/booked.

---

## Notes & Implementation considerations

* Conflict detection should use atomic check-and-reserve patterns (transaction or `findOneAndUpdate`) to avoid race conditions.
* Private booking flows should validate and record payments before reserving slots, or use provisional holds with expiry.
* The `/users/session/add-participant` route is intentionally shared across modules — the controller must resolve the session type (public vs private) and act accordingly.

---

## Summary Table

| Method | Endpoint                               | Description                       |
| ------ | -------------------------------------- | --------------------------------- |
| GET    | `/users/coach/check-conflict/:coachId` | Check time conflict for coach     |
| POST   | `/users/session/delete/:sessionId`     | Delete session by id              |
| POST   | `/users/session/private/book`          | Book private session with coach   |
| POST   | `/users/session/private/cancel`        | Cancel a private booking          |
| POST   | `/users/session/invite`                | Invite user to session            |
| PATCH  | `/users/session/add-seat/:sessionId`   | Add seats to a session            |
| PATCH  | `/users/session/remove-participant`    | Remove a participant              |
| PATCH  | `/users/session/add-participant`       | Add participants (shared)         |
| PATCH  | `/users/session/remove-invited`        | Remove pending invite             |
| GET    | `/users/session/email/:sessionId`      | Fetch session emails/participants |
| GET    | `/user/search-email`                   | Check email registration          |
| GET    | `/user/session/private/get`            | List private sessions             |

---
